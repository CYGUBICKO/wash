---
title: 'Analysis of simulated data documentation'
author: "Steve and Jonathan"
date: " `r as.Date(Sys.time())` "
output:
  html_document:
    number_sections: yes
    toc: no
    toc_depth: 3
    toc_float: yes
---




```{r setup, include=FALSE, cache=FALSE}

knitr::opts_chunk$set(echo = FALSE
	, warning = FALSE
	, message = FALSE
	, fig.width = 10
	, fig.height = 10
	, results = "asis")
options(width = 16)

library(DT)
library(data.table)
library(ggplot2)
library(cowplot)
library(tibble)
library(tidyr)
library(dplyr)
library(rstanarm)
library(bayesplot)
library(broom)

theme_set(theme_bw() +
	theme(panel.spacing=grid::unit(0,"lines")))

#load("simulateHierarchicalmvn.rda")
load("extract_summaries.rda")
#load("rstanarmModelbin.rda")
```

# Data

The data is simulated as per the writeup [here](https://cygubicko.github.io/wash/simulations_writeup.html), except that $\beta_k$, $k = 1,2,3$ are fixed. 

* Jointly simulated $\epsilon_{ik}$ with $\mu_k = \mathbf{0}$ and covariance $\mathbf{\Sigma}$
* It has `r nhouseholds` households per year repeatedly collected for `r nyears` years.


```{r}
sims_df
```

# Analysis

We use Bayesian multivariate generalized linear models with correlated group-specific terms via Stan to model the binary outcomes

* Random intercept model: Assume an intercept that is different for each year

In other words, the fitted model was specified as:

\[y_{ijk} = \beta0_{jk} + \beta1_kx_i + \epsilon_{ik}\]

		model <- stan_mvmer(
			formula = list(
				y1bin ~ wealthindex + (1 | years) + (1 | hhid)
				, y2bin ~ wealthindex + (1 | years) + (1 | hhid)
				, y3bin ~ wealthindex + (1 | years) + (1 | hhid)
			)
			, data = sim_dflist[[1]]
			, family = list(binomial, binomial, binomial)
		)

# Results

## Fixed effects

```{r}
fixed_effects
```

## Marginal Posterior Parameter Estimates Plots

Plots point estimates for each parameter along with credibility intervals. In this case we are plotting the $50\%$ uncertainty interval (thick horizontal lines) and the $90\%$ uncertainty interval (thin horizontal lines). In terms of interpretation, the $50\%$ uncertainty interval identifies where $50\%$ of the marginal distribution lies for each parameter. 

<!--The  plotfun="areas" argument plots the posterior distribution of each parameter with the uncertainty intervals shaded as areas below the cuve.
-->

## Intercept and slope


```{r}
population_est_plot
sigma_est_plot_years
sigma_est_plot_hhids
betas_dens_plot
year_est_plots[[1]]
year_est_plots[[2]]
year_est_plots[[3]]
hhid_est_plots[[1]]
hhid_est_plots[[2]]
hhid_est_plots[[3]]
cor_tabs

```


