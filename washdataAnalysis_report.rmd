---
title: 'Report: Wash data analysis'
author: "Steve and Jonathan"
date: " `r as.Date(Sys.time())` "
output:
  html_document:
    fig_caption: yes
    toc: yes
    toc_depth: 4
    toc_float: yes
---


```{r setup, include=FALSE, cache=FALSE}
knitr::opts_chunk$set(echo = FALSE
	, warning = FALSE
	, message = FALSE
	, fig.width = 10
	, fig.height = 10
	, results = "asis")
options(width = 12)

library(ggplot2)
theme_set(theme_bw() +
	theme(panel.spacing=grid::unit(0,"lines")))
library(ggpubr)

library(dplyr)
library(DT)
library(scales)
library(dotwhisker)
library(ggstance)
library(corrplot)
library(lme4)
library(splines)

source("../funs/ggplot_theme.R")
source("../funs/effectsPlot.R")

load("washModeldata.rda")
#load("washTidyestimates.rda")
#load("washPredEffects.rda")
```

## Distribution of services

```{R distributions1, fig.width = 7, fig.height = 8}
summaryFunc <- function(var){
	summary_df <- (wash_df
		%>% select(var, year)
		%>% rename("temp_var" = var)
		%>% group_by(year)
		%>% summarise(prop = mean(temp_var))
		%>% ungroup()
		%>% mutate(services = var, overall = mean(prop))
	)
	return(summary_df)
}

service_props <- lapply(c("watersource", "garbagedposal", "toilettype"), summaryFunc)
service_props_df <- do.call(rbind, service_props)

prop_plot <- (ggplot(service_props_df, aes(x = factor(year, levels = 1:14, labels = 2002:2015), y = prop, group = services, colour = services))
	+ geom_point()
	+ geom_line()
	+ geom_hline(aes(yintercept = overall, group = services, colour = services), linetype = "dashed")
	+ geom_text(aes(x = max(year)-1, y = overall, group = services, label = paste0("Overall = ", scales::percent(overall)))
		, vjust = -1.5
		, show.legend = FALSE
	)
	+ labs(x = "Years"
		, y = "Proportions of\nimproved services"
		, colour = "Services"
	)
	+ scale_y_continuous(labels = percent, limits = c(0,1))
	+ scale_colour_discrete(breaks = c("watersource"
			, "garbagedposal"
			, "toilettype"
		)
	)
#	+ scale_colour_brewer(palette="Dark2")
	+ theme(legend.position = "bottom"
		, plot.title = element_text(hjust = 0.5)
	)
)

print(prop_plot)

```

## Variables

Distribution of missing cases for each of the variables. 
- Although `hungerscale` and `belowpovertyline` have more proportion of missing cases, `wealthindex` is used as a proxy for the two.

```{R missingness}
datatable(miss_cases_df, rownames = FALSE)
```
